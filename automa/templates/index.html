{% load static %}
<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <title>CONSULTOR</title>
    <link rel="stylesheet" href="{% static 'estilos.css' %}">
</head>
<body>

<video autoplay muted loop id="video-fondo">
    <source src="{% static 'fondo.mp4' %}" type="video/mp4">
    Tu navegador no soporta el video de fondo.
</video>

<h1 class="titulo">CONSULTOR DE ENTES DEL ESTADO</h1>

<div class="contenedor-central">
    <div>
        <!-- PERSONA JUR√çDICA -->
        <fieldset class="ajustado0">
            <legend>BUSCAR INFORMACION PERSONA JURIDICA</legend>
            <div style="text-align:center;">    
                <label for="nombre_pj">RAZON SOCIAL:</label>
                <input type="text" id="nombre_pj" name="nombre_pj"><br><br>
                <label for="nit">NIT:</label>
                <input type="number" id="nit" name="nit"><br><br>
                <button class="boton-animado" onclick="buscarPJ()">Enviar</button>
            </div>
        </fieldset>

        <fieldset class="ajustado">
            <legend>BUSCAR INFORMACION PERSONA NATURAL</legend>
            <div style="text-align:center;"> 
                <label for="tipo_de_documento">TIPO DE DOCUMENTO:</label>
                <select class="milista1" id="tipo_de_documento"> 
                    <option value="CC">CEDULA DE CIUDADANIA</option>
                    <option value="CE">CEDULA DE EXTRANJERIA</option>
                </select>
                <br><br>
                <label for="numero_de_documento">NUMERO DE DOCUMENTO:</label>
                <input type="number" id="numero_de_documento" name="numero_de_documento"><br><br>
                <button class="boton-animado" onclick="buscarPN()">Enviar</button>
            </div>
        </fieldset>
    </div>

    <!-- RESULTADOS -->
    <fieldset class="lotes info-consultas">
        <legend>INFORMACI√ìN DE CONSULTAS RECIENTES</legend>
        <div id="info-consultas">
            <div style="text-align:center;">
                <table style="margin: 0 auto;">
                    <tr>
                        <th>**ID**</th>
                        <th>NOMBRE / RAZON SOCIAL</th>
                        <th>DOCUMENTO DE IDENTIDAD O NIT</th>
                    </tr>
                    <tr>
                        <td>1</td>
                        <td>START-POWER</td>
                        <td>900062999</td>
                    </tr>
                    <tr>
                        <td>2</td>
                        <td>ELEFANTES</td>
                        <td>900062992</td>
                    </tr>
                    <tr>
                        <td>3</td>
                        <td>EQUINOCC</td>
                        <td>94343243</td>
                    </tr>
                    <tr>
                        <td>4</td>
                        <td>ELASTICS</td>
                        <td>8902321389</td>
                    </tr>
                    <tr>
                        <td>5</td>
                        <td>ELEQUIBICK</td>
                        <td>9454543455</td>
                    </tr>
                    <tr>
                        <td>6</td>
                        <td>ARAGN</td>
                        <td>9454546557</td>
                    </tr>
                    <tr>
                        <td>7</td>
                        <td>EQUINOCC</td>
                        <td>94343243</td>
                    </tr>
                    <tr>
                        <td>8</td>
                        <td>ELASTICS</td>
                        <td>8902321389</td>
                    </tr>
                </table>                        
                <div style="text-align:center; margin-top:20px;">
                    <a href="{% static 'listado.xlsx' %}" download>
                        <button class="boton-animado">üì• DESCARGAR ULTIMO REGISTRO</button>
                    </a>
                </div>
            </div>
        </div>
    </fieldset>
</div>

<!-- agregado -->
<div id="resultados" style="margin-top:30px; text-align:center;">
    <h2>üìä Resultados de la consulta</h2>
    <p>Aqu√≠ se mostrar√°n las capturas y archivos generados por la consulta.</p>
</div>
<!-- fin agregado -->

<script>
async function buscarPN() {
    const numDoc = document.getElementById("numero_de_documento").value;

    if (!numDoc) {
        alert("‚ö†Ô∏è Por favor ingresa un n√∫mero de documento");
        return;
    }

    const response = await fetch("/run/", {
        method: "POST",
        headers: {
            "Content-Type": "application/x-www-form-urlencoded",
            "X-CSRFToken": "{{ csrf_token }}"
        },
        body: "numero=" + encodeURIComponent(numDoc)
    });

    const data = await response.json();

    const resultados = document.getElementById("resultados");
    resultados.innerHTML = "<h2>üìä Resultados de la consulta</h2>"; // limpiar antes

    if (data.status === "ok") {
        resultados.innerHTML += `<p style="color:green;">${data.msg}</p>`;

        if (data.capturas && data.capturas.length > 0) {
            resultados.innerHTML += "<h3>üì∑ Capturas:</h3>";
            data.capturas.forEach(c => {
                resultados.innerHTML += `<img src="${c}" style="max-width:300px; margin:10px;"><br>`;
            });
        }

        if (data.archivos && data.archivos.length > 0) {
            resultados.innerHTML += "<h3>üìÇ Archivos:</h3>";
            data.archivos.forEach(a => {
                resultados.innerHTML += `<a href="${a}" target="_blank">üì• Descargar archivo</a><br>`;
            });
        }
    } else {
        resultados.innerHTML += `<p style="color:red;">${data.msg}</p>`;
    }
}
</script>

</body>
</html>
