{% load static %}
<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <title>CONSULTOR</title>
    <link rel="stylesheet" href="{% static 'estilos.css' %}">
</head>
<body>

<video autoplay muted loop id="video-fondo">
    <source src="{% static 'fondo.mp4' %}" type="video/mp4">
    Tu navegador no soporta el video de fondo.
</video>

<h1 class="titulo">CONSULTOR DE ENTES DEL ESTADO</h1>

<div class="contenedor-central">
    <div>
        <!-- PERSONA JURÍDICA -->
        <fieldset class="ajustado0">
            <legend>BUSCAR INFORMACION PERSONA JURIDICA</legend>
            <div style="text-align:center;">    
                <label for="nombre_pj">RAZON SOCIAL:</label>
                <input type="text" id="nombre_pj" name="nombre_pj"><br><br>
                <label for="nit">NIT:</label>
                <input type="number" id="nit" name="nit"><br><br>

                <!-- Botón que llama Django -->
                <button class="boton-animado" onclick="buscarPJ()">Enviar</button>
            </div>
        </fieldset>

        <fieldset class="ajustado">
            <legend>BUSCAR INFORMACION PERSONA NATURAL</legend>
            <div style="text-align:center;"> 
                <label for="tipo_de_documento">TIPO DE DOCUMENTO:</label>
                <select class="milista1" id="tipo_de_documento"> 
                    <option value="CC">CEDULA DE CIUDADANIA</option>
                    <option value="CE">CEDULA DE EXTRANJERIA</option>
                </select>
                <br><br>
                <label for="numero_de_documento">NUMERO DE DOCUMENTO:</label>
                <input type="number" id="numero_de_documento" name="numero_de_documento"><br><br>

                <!-- Botón que llama Django -->
                <button class="boton-animado" onclick="buscarPN()">Enviar</button>
            </div>
        </fieldset>
    </div>
</div>

<script>
async function buscarPN() {
    const numDoc = document.getElementById("numero_de_documento").value;
    const response = await fetch("/run/", {
        method: "POST",
        headers: {
            "Content-Type": "application/x-www-form-urlencoded",
            "X-CSRFToken": "{{ csrf_token }}"
        },
        body: "numero=" + encodeURIComponent(numDoc)
    });
    const data = await response.json();

    if (data.status === "ok") {
        alert(data.msg);

        const resultados = document.getElementById("resultados");
        resultados.innerHTML = ""; // limpiar antes

        if (data.capturas) {
            data.capturas.forEach(c => {
                resultados.innerHTML += `<img src="${c}" style="max-width:400px;"><br>`;
            });
        }
        if (data.archivos) {
            data.archivos.forEach(a => {
                resultados.innerHTML += `<a href="${a}" target="_blank">Descargar archivo</a><br>`;
            });
        }
    } else {
        alert(data.msg);
    }
}
</script>


<div id="resultados"></div>

</body>
</html>
